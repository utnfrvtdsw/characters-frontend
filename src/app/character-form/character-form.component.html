<div class="table-container">
  <div class="table-header">
    <h2>{{ isEditMode ? 'Editar Personaje' : 'Nuevo Personaje' }}</h2>
  </div>
  
  <mat-card class="form-card mat-elevation-z4">
    <form [formGroup]="characterForm" (ngSubmit)="onSubmit()" class="character-form">
      <mat-card-content>
        <div class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Nombre</mat-label>
            <input matInput type="text" formControlName="name" required>
            <mat-error *ngIf="characterForm.get('name')?.hasError('required')">
              El nombre es requerido
            </mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>Clase</mat-label>
            <input matInput type="text" formControlName="characterClass" required>
            <mat-error *ngIf="characterForm.get('characterClass')?.hasError('required')">
              La clase es requerida
            </mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>Nivel</mat-label>
            <input matInput type="number" formControlName="level" min="1" required>
            <mat-error *ngIf="characterForm.get('level')?.hasError('required')">
              El nivel es requerido
            </mat-error>
            <mat-error *ngIf="characterForm.get('level')?.hasError('min')">
              El nivel mínimo es 1
            </mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>PV</mat-label>
            <input matInput type="number" formControlName="hp" min="1" required>
            <mat-error *ngIf="characterForm.get('hp')?.hasError('required')">
              Los PV son requeridos
            </mat-error>
            <mat-error *ngIf="characterForm.get('hp')?.hasError('min')">
              Los PV deben ser al menos 1
            </mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>Maná</mat-label>
            <input matInput type="number" formControlName="mana" min="0" required>
            <mat-error *ngIf="characterForm.get('mana')?.hasError('required')">
              El maná es requerido
            </mat-error>
            <mat-error *ngIf="characterForm.get('mana')?.hasError('min')">
              El maná no puede ser negativo
            </mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>Ataque</mat-label>
            <input matInput type="number" formControlName="attack" min="0" required>
            <mat-error *ngIf="characterForm.get('attack')?.hasError('required')">
              El ataque es requerido
            </mat-error>
            <mat-error *ngIf="characterForm.get('attack')?.hasError('min')">
              El ataque no puede ser negativo
            </mat-error>
          </mat-form-field>
        </div>
        
        <mat-divider class="divider"></mat-divider>
        
        <div class="items-section">
          <div class="section-header">
            <h3>Objetos</h3>
            <button mat-button color="primary" type="button" (click)="addItem()">
              <mat-icon>add</mat-icon>
              Agregar objeto
            </button>
          </div>
          
          <div formArrayName="items" class="items-list">
            <div *ngFor="let item of items.controls; let i = index" class="item-row">
              <mat-form-field appearance="outline" class="item-input">
                <mat-label>Objeto {{i + 1}}</mat-label>
                <input matInput [formControlName]="i" required>
                <button mat-icon-button color="warn" type="button" (click)="removeItem(i)" matSuffix>
                  <mat-icon>delete</mat-icon>
                </button>
                <mat-error *ngIf="items.controls[i].hasError('required')">
                  El objeto no puede estar vacío
                </mat-error>
              </mat-form-field>
            </div>
            
            <div *ngIf="items.controls.length === 0" class="no-items">
              <p>No hay objetos agregados</p>
            </div>
          </div>
        </div>
      </mat-card-content>
      
      <mat-card-actions align="end">
        <button mat-button type="button" (click)="onCancel()">
          <mat-icon>cancel</mat-icon>
          Cancelar
        </button>
        <button mat-raised-button color="primary" type="submit" [disabled]="!characterForm.valid">
          <mat-icon>{{ isEditMode ? 'save' : 'add' }}</mat-icon>
          {{ isEditMode ? 'Actualizar' : 'Crear' }}
        </button>
      </mat-card-actions>
    </form>
  </mat-card>
  
  <div *ngIf="loading" class="loading-shade">
    <mat-spinner></mat-spinner>
  </div>
</div>
